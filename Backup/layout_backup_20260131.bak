'use client'

import { Sidebar } from '@/components/layout/Sidebar'
import { BottomNav } from '@/components/layout/BottomNav'
import { MobileHeader } from '@/components/layout/MobileHeader'
import { AnnouncementBanner } from '@/components/layout/AnnouncementBanner'
import { FloatingActionButtons } from '@/components/layout/FloatingActionButtons'
import { SidebarProvider, useSidebar } from '@/contexts/SidebarContext'

import { ThemeProvider } from '@/components/theme/ThemeContext'

import { Footer } from '@/components/layout/Footer'

function MainLayoutContent({
    children,
}: {
    children: React.ReactNode
}) {
    const { collapsed } = useSidebar()
    return (
        <div className="min-h-screen bg-apple-bg transition-colors duration-300 flex flex-col">
            {/* PC Sidebar */}
            <Sidebar />

            {/* Mobile Header (Sticky) */}
            <div className="md:hidden">
                <MobileHeader />
            </div>

            {/* Main Content */}
            <main className={`flex-1 pb-20 md:pb-16 transition-all duration-300 ${collapsed ? 'md:ml-20' : 'md:ml-72'}`}>
                <AnnouncementBanner />
                {children}
            </main>

            {/* PC Footer */}
            <Footer />

            {/* Floating Action Buttons */}
            <FloatingActionButtons />

            {/* Mobile Bottom Navigation */}
            <BottomNav />
        </div>
    )
}

export default function MainLayout({
    children,
}: {
    children: React.ReactNode
}) {
    return (
        <ThemeProvider>
            <SidebarProvider>
                <MainLayoutContent>{children}</MainLayoutContent>
            </SidebarProvider>
        </ThemeProvider>
    )
}
